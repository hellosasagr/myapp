<!doctype html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tạo Truyện Từ Vựng Tiếng Anh</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&family=Orbitron:wght@500;700;800&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <main class="app-shell">
    <header class="panel app-header">
      <div class="header-top-row">
        <p class="eyebrow">English Story Lab</p>
        <button id="themeToggleBtn" class="btn theme-toggle" type="button" aria-label="Đổi giao diện">🌙</button>
      </div>
      <h1>Tạo truyện từ vựng + luyện học thông minh</h1>
      <p class="lead">
        Nhập danh sách từ vựng tiếng Anh, hệ thống sẽ tạo truyện chứa đầy đủ từ,
        rồi hỗ trợ đọc, dịch, luyện tập và ghi nhớ theo ngữ cảnh.
      </p>
    </header>

    <nav id="sectionNav" class="section-nav">
      <a href="#secDashboard" class="nav-link">Dashboard</a>
      <a href="#secCreate" class="nav-link">Tạo truyện</a>
      <a href="#secStory" class="nav-link">Khu truyện</a>
      <a href="#secLearning" class="nav-link">Luyện tập</a>
      <a href="#secShelf" class="nav-link">Tủ sách</a>
    </nav>

    <section id="secDashboard" class="panel dashboard-panel">
      <div class="section-head">
        <h2>0) Dashboard tiến bộ</h2>
        <button class="btn help-toggle" type="button" data-target="helpDashboard" aria-expanded="false">
          Hướng dẫn
        </button>
      </div>
      <p id="helpDashboard" class="help-panel hidden">
        Dashboard tổng hợp mức học gần đây: luyện tập, flashcard, streak theo ngày và nhóm từ đang yếu.
      </p>

      <div class="stat-grid">
        <article class="stat-card">
          <p class="stat-label">Truyện đã tạo</p>
          <p id="dashStoriesValue" class="stat-value">0</p>
        </article>
        <article class="stat-card">
          <p class="stat-label">Điểm luyện tập TB</p>
          <p id="dashPracticeValue" class="stat-value">0%</p>
        </article>
        <article class="stat-card">
          <p class="stat-label">Lượt ôn flashcard</p>
          <p id="dashFlashcardValue" class="stat-value">0</p>
        </article>
        <article class="stat-card">
          <p class="stat-label">Retell + phát âm TB</p>
          <p id="dashRetentionValue" class="stat-value">0%</p>
        </article>
        <article class="stat-card">
          <p class="stat-label">Streak ngày học</p>
          <p id="dashStreakValue" class="stat-value">0</p>
        </article>
      </div>

      <div class="goal-panel">
        <div class="section-head mini">
          <h3>Mục tiêu hằng ngày</h3>
          <button class="btn help-toggle" type="button" data-target="helpGoal" aria-expanded="false">
            Hướng dẫn
          </button>
        </div>
        <p id="helpGoal" class="help-panel hidden">
          Đặt mục tiêu phút học + số từ ôn mỗi ngày, hệ thống sẽ theo dõi tiến độ hiện tại.
        </p>
        <div class="goal-controls">
          <label for="dailyMinutesGoal">Phút/ngày</label>
          <input id="dailyMinutesGoal" type="number" min="5" max="300" step="5" value="20" />
          <label for="dailyWordsGoal">Từ/ngày</label>
          <input id="dailyWordsGoal" type="number" min="5" max="300" step="1" value="15" />
          <button id="saveGoalBtn" class="btn ghost" type="button">Lưu mục tiêu</button>
          <button id="resetGoalProgressBtn" class="btn ghost" type="button">Reset tiến độ hôm nay</button>
        </div>
        <div class="goal-progress-row">
          <progress id="goalMinuteProgress" max="100" value="0"></progress>
          <p id="goalMinuteText" class="hint">Phút học: 0/0</p>
        </div>
        <div class="goal-progress-row">
          <progress id="goalWordsProgress" max="100" value="0"></progress>
          <p id="goalWordsText" class="hint">Từ đã ôn: 0/0</p>
        </div>
        <p id="dailyGoalSummary" class="hint">Chưa có tiến độ hôm nay.</p>
      </div>

      <div class="weak-panel">
        <h3>Từ đang yếu</h3>
        <ul id="dashWeakWords" class="weak-list"></ul>
      </div>
    </section>

    <div class="workspace-grid">
      <section id="secCreate" class="panel control-panel">
        <div class="section-head">
          <h2>1) Tạo truyện</h2>
          <button class="btn help-toggle" type="button" data-target="helpCreate" aria-expanded="false">
            Hướng dẫn
          </button>
        </div>
        <p id="helpCreate" class="help-panel hidden">
          Nhập từ vựng bằng dấu phẩy, chấm phẩy hoặc xuống dòng. Chọn thể loại,
          độ dài rồi bấm <strong>Tạo truyện</strong>.
        </p>

        <label for="vocabInput">Danh sách từ vựng</label>
        <textarea id="vocabInput" placeholder="Ví dụ: brave, lantern, whisper, canyon, compass" rows="8"></textarea>
        <p id="vocabCount" class="vocab-count-badge">0 từ</p>

        <div class="control">
          <p class="label-title">Thể loại truyện</p>
          <div class="genre-picker" id="genrePicker">
            <label class="genre-card">
              <input type="radio" name="storyTone" value="adventure" checked />
              <span class="genre-name">Phiêu lưu</span>
              <span class="genre-desc">Hành trình, thử thách, khám phá</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="mystery" />
              <span class="genre-name">Bí ẩn</span>
              <span class="genre-desc">Điều tra, manh mối, sự thật</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="school" />
              <span class="genre-name">Học đường</span>
              <span class="genre-desc">Lớp học, bạn bè, dự án</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="scifi" />
              <span class="genre-name">Khoa học viễn tưởng</span>
              <span class="genre-desc">Công nghệ, vũ trụ, hệ thống</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="fantasy" />
              <span class="genre-name">Giả tưởng</span>
              <span class="genre-desc">Phép thuật, thế giới mới, cổ vật</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="romance" />
              <span class="genre-name">Lãng mạn</span>
              <span class="genre-desc">Cảm xúc, mối quan hệ, lựa chọn</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="comedy" />
              <span class="genre-name">Hài hước</span>
              <span class="genre-desc">Tình huống vui, đối thoại dí dỏm</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="historical" />
              <span class="genre-name">Lịch sử</span>
              <span class="genre-desc">Bối cảnh xưa, sự kiện, tư liệu</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="business" />
              <span class="genre-name">Công sở</span>
              <span class="genre-desc">Dự án, họp nhóm, quyết định</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="survival" />
              <span class="genre-name">Sinh tồn</span>
              <span class="genre-desc">Khắc nghiệt, chiến lược, thoát hiểm</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="horror" />
              <span class="genre-name">Kinh dị</span>
              <span class="genre-desc">Rùng rợn, bí ẩn đêm, căng thẳng</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="sports" />
              <span class="genre-name">Thể thao</span>
              <span class="genre-desc">Thi đấu, đội nhóm, vượt giới hạn</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="travel" />
              <span class="genre-name">Du lịch</span>
              <span class="genre-desc">Khám phá, văn hóa, trải nghiệm</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="cooking" />
              <span class="genre-name">Ẩm thực</span>
              <span class="genre-desc">Nấu ăn, công thức, thi nấu</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="nature" />
              <span class="genre-name">Thiên nhiên</span>
              <span class="genre-desc">Động vật, sinh thái, khám phá</span>
            </label>
            <label class="genre-card">
              <input type="radio" name="storyTone" value="detective" />
              <span class="genre-name">Trinh thám</span>
              <span class="genre-desc">Phá án, chứng cứ, suy luận</span>
            </label>
          </div>
        </div>

        <div class="control">
          <label for="storyLength">Độ dài truyện</label>
          <select id="storyLength">
            <option value="short">Ngắn</option>
            <option value="medium" selected>Vừa</option>
            <option value="long">Dài</option>
          </select>
        </div>

        <div class="control">
          <label for="cefrLevel">Cấp độ ngôn ngữ (CEFR)</label>
          <select id="cefrLevel">
            <option value="a1">A1 — Sơ cấp</option>
            <option value="a2">A2 — Cơ bản</option>
            <option value="b1" selected>B1 — Trung cấp</option>
            <option value="b2">B2 — Trung cao</option>
            <option value="c1">C1 — Nâng cao</option>
          </select>
        </div>

        <div class="btn-row">
          <button id="generateBtn" class="btn primary" type="button">Tạo truyện</button>
          <button id="clearBtn" class="btn ghost" type="button">Xóa</button>
        </div>

        <div class="analysis">
          <div class="section-head mini">
            <h3>Biến thể truyện</h3>
            <button class="btn help-toggle" type="button" data-target="helpVariants" aria-expanded="false">
              Hướng dẫn
            </button>
          </div>
          <p id="helpVariants" class="help-panel hidden">
            Tạo nhanh 3 phiên bản câu chuyện từ cùng bộ từ để luyện đa ngữ cảnh.
          </p>
          <div class="btn-row small">
            <button id="generateVariantsBtn" class="btn ghost" type="button">Tạo 3 biến thể</button>
            <button id="clearVariantsBtn" class="btn ghost" type="button">Xóa biến thể</button>
          </div>
          <p id="variantsSummary" class="hint">Chưa tạo biến thể.</p>
          <ul id="variantsList" class="variant-list"></ul>
        </div>
      </section>

      <section id="secStory" class="panel story-panel">
        <div class="section-head">
          <h2>2) Khu truyện</h2>
        </div>

        <div class="subsection">
          <div class="section-head mini">
            <h3>Điều khiển đọc</h3>
            <button class="btn help-toggle" type="button" data-target="helpRead" aria-expanded="false">
              Hướng dẫn
            </button>
          </div>
          <p id="helpRead" class="help-panel hidden">
            Bấm <strong>Đọc</strong> để đọc toàn bộ truyện. Có thể tạm dừng,
            tiếp tục, dừng, chọn giọng đọc, tốc độ, đặt điểm A/B và lặp đoạn.
          </p>

          <div class="btn-row small">
            <button id="readStoryBtn" class="btn ghost" type="button">Đọc</button>
            <button id="pauseReadBtn" class="btn ghost" type="button">Tạm dừng</button>
            <button id="resumeReadBtn" class="btn ghost" type="button">Tiếp tục</button>
            <button id="stopReadBtn" class="btn ghost" type="button">Dừng</button>
            <select id="readSpeed" aria-label="Tốc độ đọc">
              <option value="0.9">Chậm</option>
              <option value="1" selected>Bình thường</option>
              <option value="1.15">Nhanh</option>
            </select>
          </div>

          <div class="read-tools">
            <label class="read-tools-label" for="readVoice">Giọng đọc</label>
            <div class="read-tools-row">
              <select id="readVoice" aria-label="Giọng đọc"></select>
              <button id="readFromSelectedBtn" class="btn ghost" type="button">
                Đọc từ câu đã chọn
              </button>
              <button id="resumeLastBtn" class="btn ghost" type="button">
                Tiếp tục lần trước
              </button>
            </div>
            <div class="read-tools-row">
              <button id="setRepeatStartBtn" class="btn ghost" type="button">Đặt A</button>
              <button id="setRepeatEndBtn" class="btn ghost" type="button">Đặt B</button>
              <button id="toggleRepeatBtn" class="btn ghost" type="button">Bật AB Repeat</button>
              <button id="clearRepeatBtn" class="btn ghost" type="button">Xóa AB</button>
            </div>
            <div class="read-tools-row">
              <button id="prevSentenceBtn" class="btn ghost" type="button">Lùi 1 câu</button>
              <button id="nextSentenceBtn" class="btn ghost" type="button">Tiến 1 câu</button>
              <select id="repeatLoopCount" aria-label="Số vòng lặp AB">
                <option value="0" selected>AB vô hạn</option>
                <option value="3">AB 3 vòng</option>
                <option value="5">AB 5 vòng</option>
                <option value="10">AB 10 vòng</option>
              </select>
            </div>
            <p id="repeatStatus" class="hint">AB Repeat: Tắt</p>
            <p id="repeatLoopStatus" class="hint">Vòng lặp AB: 0</p>
            <div class="read-progress">
              <progress id="readProgress" max="100" value="0"></progress>
              <p id="readProgressText" class="hint">Tiến độ đọc: 0%</p>
            </div>
          </div>
        </div>

        <div class="subsection">
          <div class="section-head mini">
            <h3>Lưu / xuất truyện</h3>
            <button class="btn help-toggle" type="button" data-target="helpSave" aria-expanded="false">
              Hướng dẫn
            </button>
          </div>
          <p id="helpSave" class="help-panel hidden">
            Đặt tên truyện rồi lưu vào Tủ sách. Bạn cũng có thể copy nhanh hoặc tải file `.txt`.
          </p>

          <div class="btn-row small">
            <button id="copyBtn" class="btn ghost" type="button">Copy</button>
            <button id="downloadBtn" class="btn ghost" type="button">Tải .txt</button>
          </div>

          <div class="save-row">
            <label for="storyTitle">Tên truyện</label>
            <div class="save-controls">
              <input id="storyTitle" type="text" placeholder="Đặt tên truyện để lưu vào tủ sách" />
              <button id="saveStoryBtn" class="btn primary" type="button">Lưu vào tủ sách</button>
            </div>
          </div>
        </div>

        <p id="storyStats" class="story-stats"></p>
        <article id="storyOutput" class="story-output empty">
          Câu chuyện được tạo sẽ xuất hiện ở đây.
        </article>

        <div class="section-head mini no-margin">
          <h3>Dịch nhanh theo ngữ cảnh</h3>
          <button class="btn help-toggle" type="button" data-target="helpTranslate" aria-expanded="false">
            Hướng dẫn
          </button>
        </div>
        <p id="helpTranslate" class="help-panel hidden">
          Rê chuột lên từ được tô để xem nghĩa. Bôi đen cụm/câu để hiện bản dịch tiếng Việt.
        </p>

        <div class="analysis">
          <div class="section-head mini">
            <h3>Mẫu câu (Modelling)</h3>
            <button class="btn help-toggle" type="button" data-target="helpModel" aria-expanded="false">
              Hướng dẫn
            </button>
          </div>
          <p id="helpModel" class="help-panel hidden">
            Rê chuột vào một câu trong truyện, sau đó bấm <strong>Phân tích câu đang rê</strong>.
            Hệ thống sẽ đưa công thức câu và gợi ý thay từ để tạo câu mới cùng cấu trúc.
          </p>
          <p id="sentenceModelHint" class="hint">
            Rê chuột vào 1 câu để bắt đầu phân tích mẫu câu.
          </p>
          <div class="btn-row small">
            <button id="analyzeHoveredSentenceBtn" class="btn ghost" type="button" disabled>
              Phân tích câu đang rê
            </button>
            <button id="clearSentenceModelBtn" class="btn ghost" type="button">
              Xóa phân tích
            </button>
          </div>
          <article id="sentenceModelOutput" class="story-output empty">
            Kết quả phân tích cấu trúc câu sẽ hiển thị ở đây.
          </article>
        </div>

        <div class="analysis">
          <div class="section-head mini">
            <h3>Độ bao phủ từ vựng</h3>
            <button class="btn help-toggle" type="button" data-target="helpCoverage" aria-expanded="false">
              Hướng dẫn
            </button>
          </div>
          <p id="helpCoverage" class="help-panel hidden">
            Bảng này cho biết từ nào đã xuất hiện trong truyện, từ nào còn thiếu để bạn điều chỉnh.
          </p>
          <p id="coverageSummary" class="hint">Chưa tạo truyện.</p>
          <ul id="coverageList" class="coverage-list"></ul>
        </div>

        <div class="analysis">
          <div class="section-head mini">
            <h3>Collocation & Cụm từ</h3>
            <button class="btn help-toggle" type="button" data-target="helpCollocation" aria-expanded="false">
              Hướng dẫn
            </button>
          </div>
          <p id="helpCollocation" class="help-panel hidden">
            Trích cụm từ xuất hiện tự nhiên trong truyện để học theo cụm thay vì học từng từ rời.
          </p>
          <div class="btn-row small">
            <button id="extractCollocationBtn" class="btn ghost" type="button">Trích cụm từ</button>
          </div>
          <p id="collocationSummary" class="hint">Tạo truyện rồi bấm Trích cụm từ.</p>
          <ul id="collocationList" class="collocation-list"></ul>
        </div>
      </section>
    </div>

    <section id="secLearning" class="panel learning-panel">
      <div class="section-head">
        <h2>3) Khối luyện tập</h2>
        <button class="btn help-toggle" type="button" data-target="helpLearning" aria-expanded="false">
          Hướng dẫn
        </button>
      </div>
      <p id="helpLearning" class="help-panel hidden">
        Gợi ý: tạo truyện -> luyện tập toàn bộ câu chuyện -> nghe chép toàn bộ câu để tăng phản xạ.
      </p>

      <div class="module-grid">
        <div class="analysis practice-block module-card">
          <div class="section-head mini">
            <h3>Luyện tập</h3>
            <button class="btn help-toggle" type="button" data-target="helpPractice" aria-expanded="false">
              Hướng dẫn
            </button>
          </div>
          <p id="helpPractice" class="help-panel hidden">
            Chọn dạng bài, bấm <strong>Tạo bài luyện</strong>. Hệ thống sẽ tạo bài cho toàn bộ câu chuyện.
          </p>
          <div class="btn-row small">
            <select id="practiceType" aria-label="Dạng bài tập">
              <option value="fill_blank" selected>Điền từ</option>
              <option value="multiple_choice">Trắc nghiệm</option>
              <option value="true_false">Đúng/Sai</option>
            </select>
            <select id="practiceCount" aria-label="Số câu bài tập">
              <option value="9999" selected>Toàn bộ câu chuyện</option>
            </select>
            <select id="quizTimer" aria-label="Thời gian">
              <option value="0" selected>Không giới hạn</option>
              <option value="30">30 giây</option>
              <option value="60">60 giây</option>
              <option value="90">90 giây</option>
              <option value="120">2 phút</option>
            </select>
            <button id="buildPracticeBtn" class="btn ghost" type="button">Tạo bài luyện</button>
            <button id="checkPracticeBtn" class="btn ghost" type="button">Chấm điểm</button>
            <button id="resetPracticeBtn" class="btn ghost" type="button">Làm lại</button>
          </div>
          <div id="quizTimerDisplay" class="quiz-timer-display hidden"></div>
          <p id="practiceSummary" class="hint">Tạo truyện xong rồi bấm "Tạo bài luyện" để luyện từ vựng.</p>
          <ol id="practiceList" class="practice-list"></ol>
        </div>

        <div class="analysis memory-block module-card">
          <div class="section-head mini">
            <h3>Nhớ nhanh</h3>
            <button class="btn help-toggle" type="button" data-target="helpMemory" aria-expanded="false">
              Hướng dẫn
            </button>
          </div>
          <p id="helpMemory" class="help-panel hidden">
            Bấm <strong>Bắt đầu</strong>, tự nhớ nghĩa và ngữ cảnh. Bấm <strong>Hiện gợi ý</strong> để kiểm tra.
          </p>
          <div class="btn-row small">
            <button id="startMemoryBtn" class="btn ghost" type="button">Bắt đầu</button>
            <button id="revealMemoryBtn" class="btn ghost" type="button">Hiện gợi ý</button>
          </div>
          <p id="memorySummary" class="hint">Chế độ này lặp lại từ + câu ngữ cảnh đến khi bạn nhớ.</p>
          <article id="memoryCard" class="story-output empty">Bắt đầu Memory để ôn lại từ vựng.</article>
          <div class="btn-row small">
            <button id="memoryKnownBtn" class="btn ghost" type="button">Nhớ rồi</button>
            <button id="memoryAgainBtn" class="btn ghost" type="button">Chưa nhớ</button>
          </div>
          <p id="memoryHint" class="hint"></p>
        </div>

        <div class="analysis dictation-block module-card">
          <div class="section-head mini">
            <h3>Nghe chép</h3>
            <button class="btn help-toggle" type="button" data-target="helpDictation" aria-expanded="false">
              Hướng dẫn
            </button>
          </div>
          <p id="helpDictation" class="help-panel hidden">
            Tạo bộ nghe chép từ toàn bộ câu chuyện, bấm phát câu rồi gõ lại chính xác. Hệ thống sẽ chấm độ đúng.
          </p>
          <div class="btn-row small">
            <button id="buildDictationBtn" class="btn ghost" type="button">Tạo bộ nghe chép</button>
            <button id="playDictationBtn" class="btn ghost" type="button">Phát câu</button>
          </div>
          <p id="dictationSummary" class="hint">Chưa tạo bộ nghe chép.</p>
          <p id="dictationPrompt" class="hint">Câu 0/0</p>
          <textarea id="dictationInput" rows="3"
            placeholder="Nghe xong thì gõ lại câu tiếng Anh bạn vừa nghe"></textarea>
          <div class="btn-row small">
            <button id="checkDictationBtn" class="btn ghost" type="button">Chấm câu</button>
            <button id="showDictationAnswerBtn" class="btn ghost" type="button">Xem đáp án</button>
            <button id="prevDictationBtn" class="btn ghost" type="button">Câu trước</button>
            <button id="nextDictationBtn" class="btn ghost" type="button">Câu sau</button>
          </div>
          <p id="dictationResult" class="hint"></p>
        </div>

        <div class="analysis retell-block module-card">
          <div class="section-head mini">
            <h3>Retell Mode</h3>
            <button class="btn help-toggle" type="button" data-target="helpRetell" aria-expanded="false">
              Hướng dẫn
            </button>
          </div>
          <p id="helpRetell" class="help-panel hidden">
            Viết lại ý chính của truyện bằng từ của bạn. Hệ thống chấm mức bám ý, độ phủ từ vựng và độ mạch lạc.
          </p>
          <textarea id="retellInput" rows="5" placeholder="Viết lại câu chuyện theo cách của bạn (3-7 câu)."></textarea>
          <div class="btn-row small">
            <button id="evaluateRetellBtn" class="btn ghost" type="button">Chấm Retell</button>
            <button id="clearRetellBtn" class="btn ghost" type="button">Xóa bài</button>
          </div>
          <p id="retellSummary" class="hint">Tạo truyện trước, rồi viết lại để chấm.</p>
          <article id="retellResult" class="story-output empty">
            Kết quả chấm Retell sẽ hiển thị ở đây.
          </article>
        </div>

        <div class="analysis pronunciation-block module-card">
          <div class="section-head mini">
            <h3>Pronunciation Check</h3>
            <button class="btn help-toggle" type="button" data-target="helpPronunciation" aria-expanded="false">
              Hướng dẫn
            </button>
          </div>
          <p id="helpPronunciation" class="help-panel hidden">
            Chọn mục tiêu đọc, thu giọng nói bằng micro, rồi chấm độ trùng với câu/từ mục tiêu.
          </p>
          <div class="btn-row small">
            <select id="pronunciationTargetType" aria-label="Nguồn mục tiêu phát âm">
              <option value="selected_sentence" selected>Câu đang chọn</option>
              <option value="random_vocab">Từ ngẫu nhiên</option>
              <option value="custom">Tự nhập</option>
            </select>
            <input id="pronunciationCustomInput" type="text"
              placeholder="Nhập câu hoặc từ cần luyện (khi chọn Tự nhập)" />
          </div>
          <div class="btn-row small">
            <button id="preparePronunciationBtn" class="btn ghost" type="button">Nạp mục tiêu</button>
            <button id="playPronunciationSampleBtn" class="btn ghost" type="button">Nghe mẫu</button>
            <button id="stopPronunciationSampleBtn" class="btn ghost" type="button">Dừng mẫu</button>
            <button id="startPronunciationBtn" class="btn ghost" type="button">Bắt đầu ghi âm</button>
            <button id="stopPronunciationBtn" class="btn ghost" type="button">Dừng ghi âm</button>
            <button id="checkPronunciationBtn" class="btn ghost" type="button">Chấm phát âm</button>
          </div>
          <p id="pronunciationExpected" class="hint">Mục tiêu: chưa có.</p>
          <p id="pronunciationHeard" class="hint">Bạn nói: chưa có dữ liệu.</p>
          <p id="pronunciationResult" class="hint">Chưa chấm.</p>
        </div>

        <div class="analysis flashcard-block module-card">
          <div class="section-head mini">
            <h3>Flashcard</h3>
            <button class="btn help-toggle" type="button" data-target="helpFlashcard" aria-expanded="false">
              Hướng dẫn
            </button>
          </div>
          <p id="helpFlashcard" class="help-panel hidden">
            Tạo/cập nhật thẻ từ và ôn theo lịch SM-2. Bấm hiện nghĩa rồi tự đánh giá: Khó, Vừa, Dễ.
          </p>
          <div class="btn-row small">
            <button id="seedFlashcardsBtn" class="btn ghost" type="button">Tạo/Cập nhật thẻ</button>
            <button id="startFlashcardBtn" class="btn ghost" type="button">Bắt đầu ôn</button>
          </div>
          <p id="flashcardSummary" class="hint">Chưa có thẻ nào.</p>
          <article id="flashcardCard" class="story-output empty">Từ sẽ xuất hiện ở đây.</article>
          <div class="btn-row small">
            <button id="revealFlashcardBtn" class="btn ghost" type="button">Hiện nghĩa</button>
            <button id="rateHardBtn" class="btn ghost" type="button">Khó</button>
            <button id="rateGoodBtn" class="btn ghost" type="button">Vừa</button>
            <button id="rateEasyBtn" class="btn ghost" type="button">Dễ</button>
          </div>
          <p id="flashcardMeaning" class="hint"></p>
        </div>
      </div>
    </section>

    <section id="secShelf" class="panel shelf-panel">
      <div class="section-head">
        <h2>4) Tủ sách</h2>
        <button class="btn help-toggle" type="button" data-target="helpShelf" aria-expanded="false">
          Hướng dẫn
        </button>
      </div>
      <p id="helpShelf" class="help-panel hidden">
        Tủ sách lưu cục bộ trên trình duyệt: mở lại truyện, tải file hoặc xóa mục.
      </p>
      <div class="shelf-controls">
        <input id="shelfSearchInput" type="text" placeholder="Tìm theo tên truyện hoặc từ vựng" />
        <select id="shelfToneFilter" aria-label="Lọc thể loại">
          <option value="all">Tất cả thể loại</option>
          <option value="adventure">Phiêu lưu</option>
          <option value="mystery">Bí ẩn</option>
          <option value="school">Học đường</option>
          <option value="scifi">Khoa học viễn tưởng</option>
          <option value="fantasy">Giả tưởng</option>
          <option value="romance">Lãng mạn</option>
          <option value="comedy">Hài hước</option>
          <option value="historical">Lịch sử</option>
          <option value="business">Công sở</option>
          <option value="survival">Sinh tồn</option>
          <option value="horror">Kinh dị</option>
          <option value="sports">Thể thao</option>
          <option value="travel">Du lịch</option>
          <option value="cooking">Ẩm thực</option>
          <option value="nature">Thiên nhiên</option>
          <option value="detective">Trinh thám</option>
        </select>
        <select id="shelfLengthFilter" aria-label="Lọc độ dài">
          <option value="all">Mọi độ dài</option>
          <option value="short">Ngắn</option>
          <option value="medium">Vừa</option>
          <option value="long">Dài</option>
        </select>
        <select id="shelfSortBy" aria-label="Sắp xếp tủ sách">
          <option value="newest">Mới nhất</option>
          <option value="oldest">Cũ nhất</option>
          <option value="title">Tên A-Z</option>
        </select>
      </div>
      <div class="btn-row small">
        <button id="clearShelfBtn" class="btn ghost" type="button">Xóa tủ sách</button>
        <button id="exportDataBtn" class="btn ghost" type="button">Export dữ liệu</button>
        <button id="importDataBtn" class="btn ghost" type="button">Import dữ liệu</button>
        <input id="importDataInput" type="file" accept=".json,application/json" class="hidden" />
      </div>
      <p id="shelfHint" class="hint">Chưa có truyện nào được lưu.</p>
      <ul id="shelfList" class="shelf-list"></ul>
    </section>
  </main>

  <template id="coverageItemTemplate">
    <li class="coverage-item">
      <span class="status-dot" aria-hidden="true"></span>
      <span class="word-label"></span>
    </li>
  </template>

  <template id="shelfItemTemplate">
    <li class="shelf-item">
      <div class="shelf-top">
        <h3 class="shelf-title"></h3>
        <p class="shelf-meta"></p>
      </div>
      <p class="shelf-preview"></p>
      <div class="btn-row small">
        <button class="btn ghost shelf-open" type="button">Mở</button>
        <button class="btn ghost shelf-download" type="button">Tải</button>
        <button class="btn ghost shelf-delete" type="button">Xóa</button>
      </div>
    </li>
  </template>

  <aside id="translateBubble" class="translate-bubble hidden" aria-live="polite">
    <p id="translateSource" class="translate-source"></p>
    <p id="translateResult" class="translate-result"></p>
  </aside>

  <button id="backToTopBtn" class="back-to-top hidden" type="button" aria-label="Cuộn lên đầu">↑</button>
  <div id="confettiCanvas" class="confetti-canvas"></div>

  <script src="app.js"></script>
</body>

</html>